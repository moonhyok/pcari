{% load staticfiles %}
<html>
<head>
  <meta charset="UTF-8" />
  <!-- Social media stuff -->
  <meta property="og:title" content="California Report Card"/>
  <meta property="og:type" content="website"/>
  <meta property="og:image" content="{% static 'img/cafe/cafe6.png' %}" />
  <meta property="og:url" content="{{ url_root }}/" />
  <meta property="og:description" content="The California Report Card allows visitors to grade issues facing California and to suggest issues for future report cards." />
  <!-- <link rel="stylesheet" type= "text/css" href="{% static 'pcari/pretest_style.css' %}"> -->
  <link rel="stylesheet" type= "text/css" href="{% static 'opinionspace.css' %}">
  <link rel='stylesheet' type='text/css' href="{% static 'crc-transparent-slider.css' %}">
  <!-- <script type='text/javascript' src="{% static 'crc-transparent-slider.js' %}"></script> -->
  <script type='text/javascript' src="{% static 'accounts.js' %}"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
  <title>PCARI</title>
</head>
<body>

  <div class="full-page">


    <center>
      <div class="home-btn-dialog-box">
        <div class="home-btn-title responsive-header">
          <span class="landing-page-banner">PCARI</span> 
        </div>

        <div class="home-btn-wrapper" style="width:35%;display:inline-block; text-align: right;">
          <a href="{% url 'pcari:switch_language' %}" class="translate-btn">{{translate}}</a>
          <a href="{% url 'pcari:help' %}"><img width="30px" class='help-btn-dialog' id="help-landing" src="{% static 'img/cafe/CRC_help_bttn_compress.png' %}"></a>
        </div>

      </div> 
      <!--<img class="header-img-topic center" src="{{ url_root }}/media/mobile/img/cafe/CRC_join.png"/>-->
      <br/>
        <span>{{graph_description}}</span>


      <br/>
      <div style="width:100%; display: inline-block; position:relative;" id="moon"></div>


      <style>

        text {
          font: 10px sans-serif;
        }

        .axis path,
        .axis line {
          fill: none;
          stroke: #000;
          shape-rendering: crispEdges;
        }

        .line {
          fill: none;
          stroke-width: 1.5px;
        }

        .label {
          text-anchor: middle;
        }

        .label rect {
          fill: white;
        }

        .label-key {
          font-weight: bold;
        }

      </style>

      <script src="//d3js.org/d3.v4.0.0-alpha.9.min.js"></script>
      <script>

        var parseTime = d3.timeParse("%Y");

        var margin = {top: 60, right: 80, bottom: 100, left: 80},
            width = $(window).width() - margin.right - margin.left,
            height = $(window).height()/2 - margin.top - margin.bottom,
            labelPadding = 3;

        var svg = d3.select("#moon").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom);

        

        var g = svg.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        d3.requestTsv("{% static 'data.tsv' %}", function(d) {
          d.date = parseTime(d.date);
          for (var k in d) if (k !== "date") d[k] = +d[k];
            return d;
        }, function(error, data) {
          if (error) throw error;

          var series = data.columns.slice(1).map(function(key) {
            return data.map(function(d) {
              return {
                key: key,
                date: d.date,
                value: d[key]
              };
            });
          });

          var x = d3.scaleTime()
          .domain([data[0].date, data[data.length - 1].date])
          .range([0, width]);

          var y = d3.scaleLinear()
          .domain([0, d3.max(series, function(s) { return d3.max(s, function(d) { return d.value; }); })])
          .range([height, 0]);

          var z = d3.scaleCategory10();

          g.append("g")
          .attr("class", "axis axis--x")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));

          var serie = g.selectAll(".serie")
          .data(series)
          .enter().append("g")
          .attr("class", "serie");

          serie.append("path")
          .attr("class", "line")
          .style("stroke", function(d) { return z(d[0].key); })
          .attr("d", d3.line()
            .x(function(d) { return x(d.date); })
            .y(function(d) { return y(d.value); }));

          var label = serie.selectAll(".label")
          .data(function(d) { return d; })
          .enter().append("g")
          .attr("class", "label")
          .attr("transform", function(d, i) { return "translate(" + x(d.date) + "," + y(d.value) + ")"; });

          label.append("text")
          .attr("dy", ".35em")
          .text(function(d) { return d.value; })
          .filter(function(d, i) { return i === data.length - 1; })
          .append("tspan")
          .attr("class", "label-key")
          .text(function(d) { return " " + d.key; });

          label.append("rect", "text")
          .datum(function() { return this.nextSibling.getBBox(); })
          .attr("x", function(d) { return d.x - labelPadding; })
          .attr("y", function(d) { return d.y - labelPadding; })
          .attr("width", function(d) { return d.width + 2 * labelPadding; })
          .attr("height", function(d) { return d.height + 2 * labelPadding; });
        });

      </script>

      <div class="discuss-btn-div">
        <a href="{% url 'pcari:bloom'%}"><div class='dialog-ready button-div-red responsive-btn' style="display: inline-block;">{{next}}</div></a><br/><br/>
        <!--<div class='dialog-ready2 button-div responsive-btn' style="display: inline-block;">Tell Us Your Idea</div>-->
        <!--<button type='submit' data-theme='b' class='dialog-next'  onclick="$('.dialog-text1').hide();$('.dialog-text2').show();"><font style="font-size: 16px;">Next</font></button>-->
      </div>
    </center>

  </div>
</body>
</html>